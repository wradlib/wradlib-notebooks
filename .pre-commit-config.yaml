repos:
  # --- Jupytext: create temporary .py mirrors from MyST notebooks ---
  - repo: https://github.com/mwouts/jupytext
    rev: v1.19.0.dev0
    hooks:
      - id: jupytext
        name: jupytext (md → py)
        files: "^notebooks/.*\\.md$"
        args: ["--to", "py:percent"]
        pass_filenames: false
        always_run: true

  # --- Ruff ---
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.6
    hooks:
      - id: ruff
        name: ruff (lint + fix)
        files: "^notebooks/.*\\.py$"
        args: ["--fix"]

  # --- Black ---
  - repo: https://github.com/psf/black
    rev: 25.11.0
    hooks:
      - id: black
        files: "^notebooks/.*\\.py$"

  # --- Jupytext: sync py → md (only paired mirrors) ---
  - repo: https://github.com/mwouts/jupytext
    rev: v1.19.0.dev0
    hooks:
      - id: jupytext
        name: jupytext (sync py → md)
        files: '^notebooks/(?!__init__\\.py$)(?!conftest\\.py$).*\\.py$'
        args: ["--sync"]
        # DO NOT set pass_filenames: false
        always_run: false

  # --- Cleanup temporary .py files ---
  - repo: local
    hooks:
      - id: cleanup-jupytext
        name: Remove temporary Jupytext Python mirrors
        entry: bash -c "find notebooks -type f -name '*.py' ! -name '__init__.py' ! -name 'conftest.py' -exec rm -f {} +"
        language: system
        always_run: true
